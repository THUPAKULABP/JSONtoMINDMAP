<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JSON to MindMap | Free Student Study Tool</title>

    <!-- SEO & Sharing -->
    <meta name="description"
        content="Convert JSON data into beautiful, interactive Mind Maps. Free forever tool for students.">
    <meta property="og:title" content="Interactive Mind Map Generator">
    <meta property="og:description"
        content="Generate, share, and export mind maps from JSON data. No cost, no restrictions.">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <style>
        :root {
            --primary: #1a73e8;
            --primary-hover: #1557b0;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #202124;
            --text-light: #5f6368;
            --border: #dadce0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: var(--bg);
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
        }

        /* --- CONTROL PANEL --- */
        #control-panel {
            background-color: var(--card-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: var(--shadow);
            z-index: 100;
            max-height: 45vh;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }

        body.embed-mode #control-panel {
            display: none !important;
        }

        #edit-toggle {
            display: none !important;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h1 {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            font-size: 18px;
            color: var(--primary);
        }

        .input-group label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            color: var(--text);
            margin-bottom: 6px;
        }

        textarea,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            background: #fafafa;
            transition: border-color 0.2s;
        }

        textarea:focus,
        input:focus {
            outline: none;
            border-color: var(--primary);
            background: #fff;
        }

        #json-input {
            min-height: 100px;
            resize: vertical;
        }

        .output-section {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .output-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        .output-row button {
            padding: 8px 16px;
            font-size: 13px;
            white-space: nowrap;
            font-weight: 500;
        }

        #generate-button {
            width: 100%;
            background-color: var(--primary);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        #generate-button:hover {
            background-color: var(--primary-hover);
        }

        .btn-sec {
            background-color: #f1f3f4;
            color: var(--text);
            border: 1px solid var(--border);
            cursor: pointer;
            border-radius: 6px;
        }

        .btn-sec:hover {
            background-color: #e8eaed;
        }

        .btn-accent {
            background-color: #34a853;
            color: white;
            border: none;
        }

        .btn-accent:hover {
            background-color: #2d8e47;
        }

        /* --- LOADING SPINNER --- */
        #loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* --- GRAPH --- */
        #mindmap {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--bg);
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 110;
        }

        .btn-zoom {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: white;
            color: var(--text-light);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-zoom:hover {
            color: var(--primary);
            border-color: var(--primary);
        }

        /* NODES */
        .node rect {
            fill: #fff;
            stroke: #e0e0e0;
            stroke-width: 1.5px;
            rx: 8px;
            ry: 8px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.05));
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .node:hover rect {
            stroke: var(--primary);
            stroke-width: 2px;
            filter: drop-shadow(0 4px 8px rgba(26, 115, 232, 0.2));
        }

        .node text {
            font-size: 14px;
            fill: var(--text);
            font-weight: 500;
            pointer-events: none;
            font-family: 'Inter', sans-serif;
        }

        .link {
            fill: none;
            stroke: #bbc1c9;
            stroke-width: 2px;
            opacity: 0.6;
        }

        .indicator-circle {
            fill: #fff;
            stroke: var(--primary);
            stroke-width: 1.5px;
        }

        .indicator-text {
            font-size: 12px;
            fill: var(--primary);
            font-weight: 700;
            text-anchor: middle;
            alignment-baseline: middle;
            pointer-events: none;
        }

        /* EMBED WATERMARK */
        #watermark {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 11px;
            color: var(--text-light);
            opacity: 0.5;
            pointer-events: none;
            display: none;
        }

        body.embed-mode #watermark {
            display: block;
        }
    </style>
</head>

<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <p style="margin-top:10px; font-weight:600; color:#555;">Building Your Mind Map...</p>
    </div>

    <div id="control-panel">
        <div class="panel-header">
            <h1>Mind Map Tool</h1>
            <span style="font-size: 10px; color: #999;">Student Edition • Free Forever</span>
        </div>

        <div class="input-group">
            <label for="json-input">1. Paste Data (JSON Format):</label>
            <textarea id="json-input" placeholder='{ "name": "Topic", "children": [...] }'
                spellcheck="false"></textarea>
        </div>

        <button id="generate-button" onclick="generateMindMap()">Generate Interactive Map</button>
        <div id="error-message" style="color: #d93025; font-size: 12px; margin-top: 5px; font-weight:bold;"></div>

        <div class="output-section" id="outputs">
            <div class="input-group">
                <label>2. Smart Share Link (Permanent Data):</label>
                <div class="output-row">
                    <input id="share-link" readonly type="text">
                    <button class="btn-sec" onclick="copyText('share-link')">Copy</button>
                    <button class="btn-sec"
                        onclick="window.open(document.getElementById('share-link').value, '_blank')">Open</button>
                </div>
            </div>

            <div class="input-group">
                <label>3. Actions & Exports:</label>
                <div class="output-row">
                    <button class="btn-sec" onclick="copyText('embed-code')">Copy Iframe</button>
                    <button class="btn-accent" onclick="downloadImage()">Download as Image (PNG)</button>
                </div>
                <!-- Hidden inputs for codes -->
                <input id="embed-code" type="hidden">
                <textarea id="html-output" style="display:none;"></textarea>
            </div>
        </div>
    </div>

    <div id="mindmap">
        <div id="watermark">jsontomindmap.pages.dev</div>
        <div class="controls">
            <button class="btn-zoom" onclick="zoomIn()" title="Zoom In">+</button>
            <button class="btn-zoom" onclick="zoomOut()" title="Zoom Out">-</button>
            <button class="btn-zoom" onclick="fitToScreen()" title="Reset View">⛶</button>
        </div>
    </div>

    <script>
        let root, svg, g, zoom, treemap;
        let i = 0, duration = 600;

        function showLoading(show) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }

        function copyText(id) {
            const el = document.getElementById(id);
            el.select();
            document.execCommand('copy');
            alert("Success: Copied to clipboard!");
        }

        function generateMindMap() {
            showLoading(true);
            const jsonInput = document.getElementById('json-input');
            const errorMsg = document.getElementById('error-message');
            const outputDiv = document.getElementById('outputs');

            errorMsg.textContent = '';

            setTimeout(() => {
                try {
                    const rawVal = jsonInput.value.trim();
                    if (!rawVal) throw new Error("Please enter your mind map data.");
                    let data;
                    try { data = JSON.parse(rawVal); } catch (e) { throw new Error("JSON Error: Check for missing commas or quotes."); }

                    renderGraph(data);
                    generateShareLinks(rawVal, data);
                    outputDiv.style.display = 'block';

                } catch (e) {
                    errorMsg.textContent = e.message;
                } finally {
                    showLoading(false);
                }
            }, 150);
        }

        function generateShareLinks(jsonString, dataObj) {
            const compressed = LZString.compressToEncodedURIComponent(jsonString);
            let baseUrl = window.location.origin + window.location.pathname;
            if (baseUrl.endsWith('index.html')) baseUrl = baseUrl.replace('index.html', '');
            if (!baseUrl.endsWith('/')) baseUrl += '/';

            const permLink = `${baseUrl}#map=${compressed}&embed=true`;
            document.getElementById('share-link').value = permLink;

            const iframeCode = `<iframe src="${permLink}" width="100%" height="600px" style="border:1px solid #ddd; border-radius:8px;"></iframe>`;
            document.getElementById('embed-code').value = iframeCode;

            // Simple HTML export preserved
            const cleanJson = JSON.stringify(dataObj);
            document.getElementById('html-output').value = cleanJson;
        }

        function renderGraph(data) {
            d3.select("#mindmap").select("svg").remove();
            const container = document.getElementById('mindmap');
            const w = container.clientWidth;
            const h = container.clientHeight;

            svg = d3.select("#mindmap").append("svg")
                .attr("width", "100%").attr("height", "100%")
                .attr("id", "map-svg")
                .style("background-color", "#f8f9fa")
                .attr("viewBox", `0 0 ${w} ${h}`)
                .call(d3.zoom().on("zoom", null));

            g = svg.append("g");
            zoom = d3.zoom().scaleExtent([0.1, 4]).on("zoom", (e) => g.attr("transform", e.transform));
            svg.call(zoom);

            treemap = d3.tree().nodeSize([70, 250]);
            root = d3.hierarchy(data, d => d.children);
            root.x0 = h / 2; root.y0 = 0;

            if (root.children) {
                root.children.forEach(collapse);
            }

            update(root);
            setTimeout(() => fitToScreen(), 200);
        }

        function collapse(d) {
            if (d.children) {
                d._children = d.children;
                d._children.forEach(collapse);
                d.children = null;
            }
        }

        function update(source) {
            const treeData = treemap(root);
            const nodes = treeData.descendants();
            const links = treeData.descendants().slice(1);
            nodes.forEach(d => { d.y = d.depth * 280; });

            const node = g.selectAll('g.node').data(nodes, d => d.id || (d.id = ++i));
            const nodeEnter = node.enter().append('g').attr('class', 'node')
                .attr('transform', d => `translate(${source.y0},${source.x0})`)
                .on('click', click);

            const getName = (d) => d.data.name || "Topic";

            nodeEnter.append('text').attr("dy", ".35em").attr("text-anchor", "middle").text(d => getName(d));

            // Re-calculate rect size based on text
            nodeEnter.insert('rect', 'text').each(function (d) {
                const width = Math.max(120, getName(d).length * 9 + 40);
                d3.select(this).attr("width", width).attr("height", 44)
                    .attr("x", -width / 2).attr("y", -22).attr("rx", 10).attr("ry", 10);
            });

            const indicators = nodeEnter.append("g").attr("class", "ind-group").style("opacity", 0);
            indicators.append("circle").attr("class", "indicator-circle").attr("r", 9)
                .attr("cx", d => (Math.max(120, getName(d).length * 9 + 40) / 2));
            indicators.append("text").attr("class", "indicator-text").attr("dy", 1)
                .attr("dx", d => (Math.max(120, getName(d).length * 9 + 40) / 2)).text(d => d.children ? "−" : "+");

            const nodeUpdate = node.merge(nodeEnter).transition().duration(duration)
                .attr('transform', d => `translate(${d.y},${d.x})`);

            nodeUpdate.select(".ind-group").style("opacity", d => (d.children || d._children) ? 1 : 0);
            nodeUpdate.select(".indicator-text").text(d => d.children ? "−" : "+");

            const nodeExit = node.exit().transition().duration(duration)
                .attr('transform', d => `translate(${source.y},${source.x})`).remove();

            const link = g.selectAll('path.link').data(links, d => d.id);
            const linkEnter = link.enter().insert('path', "g").attr("class", "link")
                .attr('d', d => { const o = { x: source.x0, y: source.y0 }; return diagonal(o, o); });
            link.merge(linkEnter).transition().duration(duration).attr('d', d => diagonal(d, d.parent));
            link.exit().transition().duration(duration).remove();

            nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
        }

        function diagonal(s, d) { return `M ${s.y} ${s.x} C ${(s.y + d.y) / 2} ${s.x}, ${(s.y + d.y) / 2} ${d.x}, ${d.y} ${d.x}`; }

        function click(e, d) {
            if (d.children) { d._children = d.children; d.children = null; }
            else { d.children = d._children; d._children = null; }
            update(d); centerNode(d);
        }

        function centerNode(source) {
            const t = d3.zoomTransform(svg.node());
            const w = document.getElementById('mindmap').clientWidth;
            const h = document.getElementById('mindmap').clientHeight;
            const x = -source.y * t.k + (w < 600 ? w / 4 : w / 3);
            const y = -source.x * t.k + h / 2;
            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(t.k));
        }

        function fitToScreen() {
            const w = document.getElementById('mindmap').clientWidth;
            const h = document.getElementById('mindmap').clientHeight;
            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(w / 8, h / 2).scale(0.8));
        }

        function zoomIn() { svg.transition().call(zoom.scaleBy, 1.3); }
        function zoomOut() { svg.transition().call(zoom.scaleBy, 0.7); }

        function downloadImage() {
            const node = document.getElementById('mindmap');
            htmlToImage.toPng(node)
                .then(function (dataUrl) {
                    const link = document.createElement('a');
                    link.download = 'student-mindmap.png';
                    link.href = dataUrl;
                    link.click();
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const example = { "name": "Main Concept", "children": [{ "name": "Subtopic A", "children": [{ "name": "Detail 1" }] }, { "name": "Subtopic B" }] };
            const jsonBox = document.getElementById('json-input');
            const hash = window.location.hash;

            if (hash.includes("embed=true")) {
                document.body.classList.add('embed-mode');
            }

            if (hash.includes("#map=")) {
                try {
                    const compressed = hash.split("map=")[1].split("&")[0];
                    const decompressed = LZString.decompressFromEncodedURIComponent(compressed);

                    if (decompressed) {
                        jsonBox.value = decompressed;
                        let checkLibs = setInterval(() => {
                            if (typeof d3 !== 'undefined') {
                                clearInterval(checkLibs);
                                generateMindMap();
                            }
                        }, 100);
                        return;
                    }
                } catch (e) { console.error("Link Error", e); }
            }
            jsonBox.value = JSON.stringify(example, null, 2);
            generateMindMap();
        });

        window.addEventListener('resize', () => {
            if (svg) {
                const c = document.getElementById('mindmap');
                svg.attr("viewBox", `0 0 ${c.clientWidth} ${c.clientHeight}`);
            }
        });
    </script>
</body>

</html>