<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Goal</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: sans-serif; background: #f8f9fa; }
        .node rect { fill: #fff; stroke: #ccc; stroke-width: 1.5px; rx: 20px; ry: 20px; }
        .node:hover rect { stroke: #1a73e8; }
        .node text { font-size: 14px; pointer-events: none; }
        .link { fill: none; stroke: #ccc; stroke-width: 1.5px; opacity: 0.8; }
        .controls { position: absolute; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 5px; }
        .btn { width: 40px; height: 40px; background: white; border: 1px solid #ccc; font-size: 20px; cursor: pointer; border-radius: 50%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .node.concept-force rect { stroke: #8ab4f8; background-color: #f1f7ff; }
        .node.concept-pressure rect { stroke: #f6aea9; background-color: #fce8e6; }
    </style>
</head>
<body>
    <div class="controls">
        <button class="btn" onclick="zoomIn()">+</button>
        <button class="btn" onclick="zoomOut()">-</button>
        <button class="btn" onclick="reset()">â›¶</button>
    </div>
    <div id="graph" style="width:100vw; height:100vh;"></div>

<script>
    const data = {
  "name": "Project Goal",
  "children": [
    {
      "name": "Research",
      "type": "concept-force",
      "children": [
        {
          "name": "Competitor Analysis"
        },
        {
          "name": "User Interviews"
        }
      ]
    },
    {
      "name": "Development",
      "type": "concept-pressure",
      "children": [
        {
          "name": "Frontend"
        },
        {
          "name": "Backend"
        }
      ]
    }
  ]
};
    
    let i = 0, duration = 750, root;
    const svg = d3.select("#graph").append("svg").attr("width", window.innerWidth).attr("height", window.innerHeight);
    const g = svg.append("g");
    
    const zoom = d3.zoom().scaleExtent([0.1, 4]).on("zoom", (e) => g.attr("transform", e.transform));
    svg.call(zoom);
    
    const treemap = d3.tree().nodeSize([60, 250]);
    root = d3.hierarchy(data, d => d.children);
    root.x0 = window.innerHeight / 2; root.y0 = 0;

    // Initial collapse
    if(root.children) root.children.forEach(collapse);
    function collapse(d) {
        if(d.children) { d._children = d.children; d._children.forEach(collapse); d.children = null; }
    }

    update(root);
    reset();

    function update(source) {
        const treeData = treemap(root);
        const nodes = treeData.descendants();
        const links = treeData.descendants().slice(1);
        
        nodes.forEach(d => { d.y = d.depth * 280; });

        const node = g.selectAll('g.node').data(nodes, d => d.id || (d.id = ++i));
        
        const nodeEnter = node.enter().append('g').attr('class', d => `node ${d.data.type || ''}`)
            .attr('transform', d => `translate(${source.y0},${source.x0})`).on('click', click);
            
        nodeEnter.append('rect').each(function(d) {
            const w = Math.max(120, d.data.name.length * 8 + 40);
            d3.select(this).attr("width", w).attr("height", 40).attr("x", -w/2).attr("y", -20);
        });
        
        nodeEnter.append('text').attr("dy", ".35em").attr("text-anchor", "middle").text(d => d.data.name);
        
        // Indicator for children
        nodeEnter.append("circle").attr("r", 5).attr("cx", d => (Math.max(120, d.data.name.length*8+40)/2)).attr("fill", "#1a73e8").style("opacity", d => d._children ? 1 : 0);

        const nodeUpdate = node.merge(nodeEnter).transition().duration(duration)
            .attr('transform', d => `translate(${d.y},${d.x})`);
            
        nodeUpdate.select("circle").style("opacity", d => (d.children || d._children) ? 1 : 0).attr("fill", d => d.children ? "#fff" : "#1a73e8").attr("stroke", "#1a73e8");

        node.exit().transition().duration(duration)
            .attr('transform', d => `translate(${source.y},${source.x})`).remove();

        const link = g.selectAll('path.link').data(links, d => d.id);
        const linkEnter = link.enter().insert('path', "g").attr("class", "link")
            .attr('d', d => { const o = {x: source.x0, y: source.y0}; return diagonal(o, o); });
            
        link.merge(linkEnter).transition().duration(duration).attr('d', d => diagonal(d, d.parent));
        link.exit().transition().duration(duration).attr('d', d => { const o = {x: source.x, y: source.y}; return diagonal(o, o); }).remove();
        
        nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
    }

    function diagonal(s, d) {
        return `M ${s.y} ${s.x} C ${(s.y + d.y) / 2} ${s.x}, ${(s.y + d.y) / 2} ${d.x}, ${d.y} ${d.x}`;
    }

    function click(event, d) {
        if (d.children) { d._children = d.children; d.children = null; } 
        else { d.children = d._children; d._children = null; }
        update(d);
    }
    
    function zoomIn() { svg.transition().call(zoom.scaleBy, 1.3); }
    function zoomOut() { svg.transition().call(zoom.scaleBy, 0.7); }
    function reset() { 
        svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(window.innerWidth/6, window.innerHeight/2)); 
    }
    
    window.onresize = () => svg.attr("width", window.innerWidth).attr("height", window.innerHeight);
</script>
</body>
</html>
