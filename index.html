<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JSON to MindMap | Free Student Study Tool</title>

    <!-- SEO & Sharing -->
    <meta name="description"
        content="Generate and share interactive Mind Maps from JSON data. 100% Free and permanent tool for students.">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <!-- Dependencies (Loaded from Free CDNs - Takes 0 space in your repo) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <style>
        :root {
            --primary: #1a73e8;
            --primary-hover: #1557b0;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text: #202124;
            --text-light: #5f6368;
            --border: #dadce0;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: var(--bg);
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
        }

        /* --- CONTROL PANEL --- */
        #control-panel {
            background-color: var(--card-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 100;
            max-height: 45vh;
            overflow-y: auto;
        }

        body.embed-mode #control-panel {
            display: none !important;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header h1 {
            font-family: 'Outfit', sans-serif;
            margin: 0;
            font-size: 18px;
            color: var(--primary);
        }

        .input-group label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            color: var(--text);
            margin-bottom: 6px;
        }

        textarea,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            box-sizing: border-box;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            background: #fafafa;
        }

        #json-input {
            min-height: 100px;
            resize: vertical;
        }

        .output-section {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .output-row {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
        }

        #generate-button {
            width: 100%;
            background-color: var(--primary);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        button {
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-sec {
            background-color: #f1f3f4;
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
        }

        .btn-sec:hover {
            background-color: #e8eaed;
        }

        .btn-accent {
            background-color: #34a853;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 500;
        }

        .btn-accent:hover {
            background-color: #2d8e47;
        }

        .btn-download {
            background-color: #fbbc04;
            color: #3c4043;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 600;
        }

        /* --- GRAPH --- */
        #mindmap {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--bg);
            width: 100%;
            height: 100%;
            touch-action: none;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 110;
        }

        .btn-zoom {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: white;
            color: var(--text-light);
            border: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .node rect {
            fill: #fff;
            stroke: #e0e0e0;
            stroke-width: 1.5px;
            rx: 8px;
            ry: 8px;
            transition: all 0.3s;
        }

        .node:hover rect {
            stroke: var(--primary);
            stroke-width: 2px;
        }

        .node text {
            font-size: 14px;
            fill: var(--text);
            font-weight: 500;
            pointer-events: none;
        }

        .link {
            fill: none;
            stroke: #bbc1c9;
            stroke-width: 2px;
            opacity: 0.6;
        }

        .indicator-circle {
            fill: #fff;
            stroke: var(--primary);
            stroke-width: 1.5px;
        }

        .indicator-text {
            font-size: 12px;
            fill: var(--primary);
            font-weight: 700;
            text-anchor: middle;
            alignment-baseline: middle;
            pointer-events: none;
        }

        #loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <p style="margin-top:10px; font-weight:600; color:#555;">Processing Map...</p>
    </div>

    <div id="control-panel">
        <div class="panel-header">
            <h1>Mind Map Studio</h1>
            <span style="font-size: 10px; color: #999;">Free Student Tool • Serverless</span>
        </div>

        <div class="input-group">
            <label for="json-input">1. Mind Map JSON Data:</label>
            <textarea id="json-input" placeholder='Paste JSON here...' spellcheck="false"></textarea>
        </div>

        <button id="generate-button" onclick="generateMindMap()">Build Mind Map</button>
        <div id="error-message" style="color: #d93025; font-size: 12px; margin-top: 5px; font-weight:bold;"></div>

        <div class="output-section" id="outputs">
            <div class="input-group">
                <label>2. Smart Share Link (Contains Data):</label>
                <div class="output-row">
                    <input id="share-link" readonly type="text">
                    <button class="btn-sec" onclick="copyText('share-link')">Copy</button>
                    <button class="btn-sec"
                        onclick="window.open(document.getElementById('share-link').value, '_blank')">Open</button>
                </div>
            </div>

            <div class="input-group">
                <label>3. Offline Self-Sustaining Files:</label>
                <div class="output-row">
                    <button class="btn-accent" onclick="downloadImage()">Save as Image (PNG)</button>
                    <button class="btn-download" onclick="downloadOfflineHTML()">Download Offline Tool (HTML)</button>
                </div>
                <input id="embed-code" type="hidden">
            </div>
        </div>
    </div>

    <div id="mindmap">
        <div class="controls">
            <button class="btn-zoom" onclick="zoomIn()">+</button>
            <button class="btn-zoom" onclick="zoomOut()">-</button>
            <button class="btn-zoom" onclick="fitToScreen()">⛶</button>
        </div>
    </div>

    <script>
        let root, svg, g, zoom, treemap, currentData;
        let i = 0, duration = 600;

        function showLoading(show) { document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none'; }
        function copyText(id) { const el = document.getElementById(id); el.select(); document.execCommand('copy'); alert("Copied!"); }

        function generateMindMap() {
            showLoading(true);
            const jsonInput = document.getElementById('json-input');
            const errorMsg = document.getElementById('error-message');
            const outputDiv = document.getElementById('outputs');
            errorMsg.textContent = '';
            setTimeout(() => {
                try {
                    const rawVal = jsonInput.value.trim();
                    if (!rawVal) throw new Error("Please enter data.");
                    currentData = JSON.parse(rawVal);
                    renderGraph(currentData);
                    generateShareLinks(rawVal);
                    outputDiv.style.display = 'block';
                } catch (e) { errorMsg.textContent = "Error: " + e.message; }
                finally { showLoading(false); }
            }, 100);
        }

        function generateShareLinks(jsonString) {
            const compressed = LZString.compressToEncodedURIComponent(jsonString);
            let baseUrl = window.location.origin + window.location.pathname;
            if (baseUrl.endsWith('index.html')) baseUrl = baseUrl.replace('index.html', '');
            if (!baseUrl.endsWith('/')) baseUrl += '/';
            const permLink = `${baseUrl}#map=${compressed}&embed=true`;
            document.getElementById('share-link').value = permLink;
            document.getElementById('embed-code').value = `<iframe src="${permLink}" width="100%" height="600px" style="border:1px solid #ddd; border-radius:8px;"></iframe>`;
        }

        function renderGraph(data) {
            d3.select("#mindmap").select("svg").remove();
            const container = document.getElementById('mindmap'), w = container.clientWidth, h = container.clientHeight;
            svg = d3.select("#mindmap").append("svg").attr("width", "100%").attr("height", "100%").attr("id", "map-svg").style("background-color", "#f8f9fa").attr("viewBox", `0 0 ${w} ${h}`).call(d3.zoom().on("zoom", null));
            g = svg.append("g");
            zoom = d3.zoom().scaleExtent([0.1, 4]).on("zoom", (e) => g.attr("transform", e.transform));
            svg.call(zoom);
            treemap = d3.tree().nodeSize([70, 250]);
            root = d3.hierarchy(data, d => d.children);
            root.x0 = 0; root.y0 = 0;
            if (root.children) root.children.forEach(collapse);
            update(root);
            setTimeout(() => fitToScreen(), 200);
        }

        function collapse(d) {
            if (d.children) { d._children = d.children; d._children.forEach(collapse); d.children = null; }
        }

        function update(source) {
            const treeData = treemap(root), nodes = treeData.descendants(), links = treeData.descendants().slice(1);
            nodes.forEach(d => { d.y = d.depth * 280; });
            const node = g.selectAll('g.node').data(nodes, d => d.id || (d.id = ++i));
            const nodeEnter = node.enter().append('g').attr('class', 'node').attr('transform', d => `translate(${source.y0},${source.x0})`).on('click', click);
            const getName = (d) => d.data.name || "Topic";
            nodeEnter.append('text').attr("dy", ".35em").attr("text-anchor", "middle").text(d => getName(d));
            nodeEnter.insert('rect', 'text').each(function (d) {
                const width = Math.max(120, getName(d).length * 9 + 40);
                d3.select(this).attr("width", width).attr("height", 44).attr("x", -width / 2).attr("y", -22).attr("rx", 10).attr("ry", 10);
            });
            const indicators = nodeEnter.append("g").attr("class", "ind-gp").style("opacity", 0);
            indicators.append("circle").attr("class", "indicator-circle").attr("r", 9).attr("cx", d => (Math.max(120, getName(d).length * 9 + 40) / 2));
            indicators.append("text").attr("class", "indicator-text").attr("dy", 1).attr("dx", d => (Math.max(120, getName(d).length * 9 + 40) / 2)).text(d => d.children ? "−" : "+");
            const nodeUpdate = node.merge(nodeEnter).transition().duration(duration).attr('transform', d => `translate(${d.y},${d.x})`);
            nodeUpdate.select(".ind-gp").style("opacity", d => (d.children || d._children) ? 1 : 0);
            nodeUpdate.select(".indicator-text").text(d => d.children ? "−" : "+");
            node.exit().transition().duration(duration).attr('transform', d => `translate(${source.y},${source.x})`).remove();
            const link = g.selectAll('path.link').data(links, d => d.id);
            const linkEnter = link.enter().insert('path', "g").attr("class", "link").attr('d', d => { const o = { x: source.x0, y: source.y0 }; return diagonal(o, o); });
            link.merge(linkEnter).transition().duration(duration).attr('d', d => diagonal(d, d.parent));
            link.exit().transition().duration(duration).remove();
            nodes.forEach(d => { d.x0 = d.x; d.y0 = d.y; });
        }

        function diagonal(s, d) { return `M ${s.y} ${s.x} C ${(s.y + d.y) / 2} ${s.x}, ${(s.y + d.y) / 2} ${d.x}, ${d.y} ${d.x}`; }
        function click(e, d) {
            if (d.children) { d._children = d.children; d.children = null; }
            else { d.children = d._children; d._children = null; }
            update(d); centerNode(d);
        }

        function centerNode(source) {
            const t = d3.zoomTransform(svg.node()), w = document.getElementById('mindmap').clientWidth, h = document.getElementById('mindmap').clientHeight;
            const x = -source.y * t.k + (w < 600 ? w / 4 : w / 3), y = -source.x * t.k + h / 2;
            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(t.k));
        }

        function fitToScreen() {
            const w = document.getElementById('mindmap').clientWidth, h = document.getElementById('mindmap').clientHeight;
            svg.transition().duration(750).call(zoom.transform, d3.zoomIdentity.translate(w / 8, h / 2).scale(0.8));
        }

        function zoomIn() { svg.transition().call(zoom.scaleBy, 1.3); }
        function zoomOut() { svg.transition().call(zoom.scaleBy, 0.7); }

        function downloadImage() {
            htmlToImage.toPng(document.getElementById('mindmap')).then(function (dataUrl) {
                const link = document.createElement('a'); link.download = 'mindmap.png'; link.href = dataUrl; link.click();
            });
        }

        function downloadOfflineHTML() {
            const currentJson = JSON.stringify(currentData);
            const blob = new Blob([document.documentElement.outerHTML.replace('placeholder="Paste JSON here..."', `placeholder='Paste JSON here...' value='${currentJson}'`).replace('let currentData;', `let currentData = ${currentJson};`)], { type: 'text/html' });
            const link = document.createElement('a'); link.download = 'offline-mindmap.html'; link.href = URL.createObjectURL(blob); link.click();
        }

        document.addEventListener('DOMContentLoaded', () => {
            const jsonBox = document.getElementById('json-input'), hash = window.location.hash;
            if (hash.includes("embed=true")) document.body.classList.add('embed-mode');
            if (hash.includes("#map=")) {
                try {
                    const compressed = hash.split("map=")[1].split("&")[0], decompressed = LZString.decompressFromEncodedURIComponent(compressed);
                    if (decompressed) {
                        jsonBox.value = decompressed;
                        let check = setInterval(() => { if (typeof d3 !== 'undefined') { clearInterval(check); generateMindMap(); } }, 100);
                        return;
                    }
                } catch (e) { }
            }
            jsonBox.value = JSON.stringify({ "name": "Main Concept", "children": [{ "name": "Branch 1" }, { "name": "Branch 2" }] }, null, 2);
            generateMindMap();
        });
    </script>
</body>

</html>